<div class="min-h-screen bg-gray-50">
  <%= render 'shared/header' %>

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Page Header -->
    <div class="mb-6">
      <h1 class="text-3xl font-bold text-gray-900">Sprite Collection</h1>
      <p class="text-gray-600 mt-1">Unlock characters by completing tasks and achievements!</p>
    </div>
    <!-- Collection Stats -->
    <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
      <h2 class="text-2xl font-bold text-gray-800 mb-4">Your Collection</h2>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
        <div class="text-center">
          <div class="text-3xl font-bold text-primary-600"><%= @collection_stats[:total_unlocked] %> / <%= @collection_stats[:total_sprites] %></div>
          <div class="text-sm text-gray-600">Total Collected</div>
        </div>
        <div class="text-center">
          <div class="text-3xl font-bold text-green-600"><%= @collection_stats[:percentage] %>%</div>
          <div class="text-sm text-gray-600">Completion</div>
        </div>
        <div class="text-center">
          <div class="text-2xl font-bold">
            <span class="text-orange-500" title="Legendary"><%= @collection_stats[:legendary_count] %></span> /
            <span class="text-primary-500" title="Epic"><%= @collection_stats[:epic_count] %></span> /
            <span class="text-blue-500" title="Rare"><%= @collection_stats[:rare_count] %></span>
          </div>
          <div class="text-sm text-gray-600">L / E / R</div>
        </div>
        <div class="text-center">
          <div class="text-2xl font-bold">
            <span class="text-green-500" title="Uncommon"><%= @collection_stats[:uncommon_count] %></span> /
            <span class="text-gray-500" title="Common"><%= @collection_stats[:common_count] %></span>
          </div>
          <div class="text-sm text-gray-600">U / C</div>
        </div>
      </div>
      
      <!-- Progress Bar -->
      <div class="w-full bg-gray-200 rounded-full h-4 overflow-hidden">
        <div class="bg-gradient-to-r from-primary-600 to-secondary-700 h-full rounded-full transition-all duration-500"
             style="width: <%= @collection_stats[:percentage] %>%"></div>
      </div>
    </div>

    <!-- Recent Unlocks -->
    <% if @recent_unlocks.any? %>
      <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
        <h3 class="text-xl font-bold text-gray-800 mb-4">Recently Unlocked</h3>
        <div class="flex gap-4 overflow-x-auto pb-2">
          <% @recent_unlocks.each do |user_sprite| %>
            <div class="flex-shrink-0 text-center">
              <div class="sprite-container <%= user_sprite.sprite_character.rarity %>">
                <div class="sprite <%= user_sprite.sprite_character.css_class %>"></div>
              </div>
              <p class="text-sm font-medium mt-2"><%= user_sprite.sprite_character.name %></p>
              <p class="text-xs text-gray-500"><%= time_ago_in_words(user_sprite.unlocked_at) %> ago</p>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>

    <!-- Sprites by Rarity -->
    <% @sprites_by_rarity.each do |rarity, sprites| %>
      <% next if sprites.empty? %>
      <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
        <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
          <span class="<%= rarity == :legendary ? 'text-orange-500' : 
                          rarity == :epic ? 'text-primary-500' : 
                          rarity == :rare ? 'text-blue-500' : 
                          rarity == :uncommon ? 'text-green-500' : 
                          'text-gray-500' %>">
            <%= rarity.to_s.capitalize %> Sprites
          </span>
          <span class="text-sm text-gray-500 font-normal">
            (<%= sprites.select { |s| @unlocked_sprite_ids.include?(s.id) }.count %> / <%= sprites.count %>)
          </span>
        </h3>
        
        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-6">
          <% sprites.each do |sprite| %>
            <% is_unlocked = @unlocked_sprite_ids.include?(sprite.id) %>
            <div class="text-center group">
              <div class="sprite-container <%= sprite.rarity %> <%= 'locked' unless is_unlocked %> 
                          hover:scale-110 transition-transform cursor-pointer"
                   title="<%= is_unlocked ? sprite.description : "#{sprite.unlock_condition}" %>">
                <div class="sprite <%= sprite.css_class %>"></div>
              </div>
              <p class="text-sm font-medium mt-2 <%= is_unlocked ? '' : 'text-gray-400' %>">
                <%= sprite.name %>
              </p>
              <% if is_unlocked %>
                <% unlock_date = @user.user_sprites.find_by(sprite_character: sprite)&.unlocked_at %>
                <p class="text-xs text-green-600">Unlocked!</p>
              <% else %>
                <p class="text-xs text-gray-500 group-hover:text-primary-600 transition-colors">
                  <%= sprite.unlock_condition %>
                </p>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>

    <!-- Tips Section -->
    <div class="bg-primary-50 rounded-xl p-6 mt-8">
      <h3 class="text-lg font-bold text-gray-900 mb-3">How to Unlock More Sprites</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-700">
        <div class="flex items-start gap-2">
          <span class="text-primary-600">üìã</span>
          <span><strong>Complete Tasks:</strong> Some sprites unlock after completing a certain number of tasks</span>
        </div>
        <div class="flex items-start gap-2">
          <span class="text-primary-600">üî•</span>
          <span><strong>Build Streaks:</strong> Maintain daily streaks to unlock streak-based sprites</span>
        </div>
        <div class="flex items-start gap-2">
          <span class="text-primary-600">‚≠ê</span>
          <span><strong>Earn Points:</strong> Accumulate points to unlock point-based sprites</span>
        </div>
        <div class="flex items-start gap-2">
          <span class="text-primary-600">üèÜ</span>
          <span><strong>Special Conditions:</strong> Some sprites have unique unlock requirements!</span>
        </div>
      </div>
    </div>
  </div>
</div>